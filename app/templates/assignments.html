{% extends "base.html" %}
{% block title %}Assignments | StudyMate{% endblock %}

{% block extra_css %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/assignments.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/form.css') }}">
{% endblock %}

{% block navbar %}

<nav class="navbar card">
    <div class="nav-left">
        <img src="{{ url_for('static', filename='images/study_logo.png') }}" class="nav-logo" alt="StudyMate logo">
        <span class="brand-name">StudyMate</span>
    </div>


<div class="nav-center">
    <a href="{{ url_for('main.home') }}" class="nav-link">Home</a>
    <a href="{{ url_for('classes.list_classes') }}" class="nav-link">Classes</a>
    <a href="{{ url_for('assignment.list_assignments') }}" class="nav-link active">Assignments</a>
    <a href="{{ url_for('study.study_sessions') }}" class="nav-link">Study Sessions</a>
    <a href="{{ url_for('dashboard.graphs') }}" class="nav-link">Dashboard</a>
    <a href="{{ url_for('calendar.home') }}" class="nav-link">Calendar</a>
</div>

<div class="nav-right">
    <a href="{{ url_for('auth.logout') }}" class="logout-link">Logout</a>
    <div class="user-avatar">
        <img src="{{ url_for('static', filename='images/user_avatar.png') }}" alt="User avatar">
    </div>
    <button class="theme-toggle" aria-label="Toggle theme">
        <span class="toggle-icon">‚òÄÔ∏è</span>
    </button>
</div>

</nav>
{% endblock %}

{% block content %}

<div class="assignments-container">


<!-- ================= TOP ACTIONS ================= -->
<section class="assignments-top card">
    <div class="top-left">
        <h1>Your Assignments</h1>
        <p class="muted">Track deadlines, grades, and completion</p>
    </div>
    <div class="top-right">
        <button class="btn-tiny" data-open-modal="addAssignmentModal">+ Add Assignment</button>
    </div>
</section>

<!-- ================= REMINDERS ================= -->
<section class="assignments-reminders">
    <div class="card upcoming-deadlines">
        <h3>Upcoming Deadlines</h3>
        <ul class="deadline-list">
            <!-- JS inject upcoming assignments -->
            <li class="placeholder">No upcoming deadlines</li>
        </ul>
    </div>

    <div class="card calendar-preview">
        <h3>This Month</h3>
        <div class="calendar-grid">
            <!-- Calendar scaffold only -->
        </div>
    </div>
</section>

<!-- ================= FILTER PANEL ================= -->
<section class="assignments-filters card">
    <div class="filter-group">
        <label for="dueFilter" class="input-label">Due Status</label>
        <select id="dueFilter" name="due_status" class="input-field">
            <option value="all">All</option>
            <option value="overdue">Overdue</option>
            <option value="not_due">Not Due</option>
        </select>
    </div>

    <div class="filter-group">
        <label for="completionFilter" class="input-label">Completion</label>
        <select id="completionFilter" name="completion" class="input-field">
            <option value="all">All</option>
            <option value="completed">Completed</option>
            <option value="uncompleted">Uncompleted</option>
        </select>
    </div>

    <div class="filter-group">
        <label for="gradedFilter" class="input-label">Graded</label>
        <select id="gradedFilter" name="graded" class="input-field">
            <option value="all">All</option>
            <option value="graded">Graded</option>
            <option value="not_graded">Not Graded</option>
        </select>
    </div>

    <fieldset class="filter-group wide">
        <legend class="input-label">Assignment Type</legend>

        <div class="checkbox-row">

            <label for="type-homework">
                <input type="checkbox" id="type-homework" name="assignment_type" value="homework" checked>
                Homework
            </label>

            <label for="type-test">
                <input type="checkbox" id="type-test" name="assignment_type" value="test" checked>
                Test
            </label>

            <label for="type-quiz">
                <input type="checkbox" id="type-quiz" name="assignment_type" value="quiz" checked>
                Quiz
            </label>

            <label for="type-project">
                <input type="checkbox" id="type-project" name="assignment_type" value="project" checked>
                Project
            </label>

            <label for="type-lab-report">
                <input type="checkbox" id="type-lab-report" name="assignment_type" value="lab_report" checked>
                Lab Report
            </label>

            <label for="type-essay">
                <input type="checkbox" id="type-essay" name="assignment_type" value="essay" checked>
                Essay
            </label>

            <label for="type-exam">
                <input type="checkbox" id="type-exam" name="assignment_type" value="exam" checked>
                Exam
            </label>

            <label for="type-other">
                <input type="checkbox" id="type-other" name="assignment_type" value="other" checked>
                Other
            </label>

        </div>
    </fieldset>


    <div class="filter-group">
        <label for="tableMode" class="input-label">Table Mode</label>
        <select id="tableMode" name="table_mode" class="input-field">
            <option value="single">Single Table</option>
            <option value="per_class">One Table per Class</option>
        </select>
    </div>
</section>

<!-- ================= ASSIGNMENTS TABLE ================= -->
<section class="assignments-table-wrapper">

    <div class="table-actions">
        <button class="btn-tiny" id="bulkEditBtn">‚úè Edit</button>
        <button class="btn-tiny danger" id="bulkDeleteBtn">üóë Delete</button>
    </div>

    <div class="card assignments-table-card">
        <table class="assignments-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Class</th>
                    <th>Type</th>
                    <th>Due Date</th>
                    <th>Completed</th>
                    <th>Grade</th>
                    <th>Graded</th>
                    <th>Ponderation</th>
                    <th>Pass Grade</th>
                </tr>
            </thead>
            <tbody>
            {% for a in assignments %}
            <tr
                data-assignment-id="{{ a.assignment_id }}"
                data-class-id="{{ a.class_id }}"
                data-completed="{{ a.is_completed }}"
                data-graded="{{ a.is_graded }}"
            >
                <td>{{ a.title }}</td>
                <td>{{ a.class_name }}</td>
                <td>{{ a.assignment_type|capitalize }}</td>
                <td>{% if a.due_date %}{{ a.due_date.strftime('%Y-%m-%d') }}{% else %}‚Äî{% endif %}</td>
                <td><input type="checkbox" class="complete-checkbox" aria-label = "Assignment completed" {% if a.is_completed %}checked{% endif %} disabled></td>

                <!-- Grade -->
                <td>
                    {% if a.is_completed %}
                    <input type="number" class="inline-grade-input" aria-label="Assignment grade" value="{{ a.grade if a.grade is not none else '' }}" min="0" max="100" step="0.1" placeholder="‚Äî" disabled>
                    {% else %}‚Äî{% endif %}
                </td>

                <!-- Graded Checkbox -->
                <td><input type="checkbox" aria-label="Assignment graded" {% if a.is_graded %}checked{% endif %} disabled></td>

                <!-- Ponderation -->
                <td>{% if a.is_graded and a.ponderation %}{{ a.ponderation }}%{% else %}‚Äî{% endif %}</td>

                <!-- Pass Grade -->
                <td>{% if a.is_graded and a.pass_grade %}{{ a.pass_grade }}%{% else %}‚Äî{% endif %}</td>
            </tr>
            {% endfor %}
            </tbody>
    

        </table>
    </div>
</section>

<!-- ================= ANALYTICS ================= -->
<section class="assignments-analytics">
    <div class="card chart-card">
        <h3>Completion Breakdown</h3>
        <div class="chart-toggle">
            <button class="btn-tiny active">Simple</button>
            <button class="btn-tiny">Detailed</button>
        </div>
        <canvas id="assignmentCompletionChart"></canvas>
    </div>

    <div class="card chart-card">
        <h3>Grade Distribution</h3>
        <canvas id="assignmentGradeChart"></canvas>
    </div>
</section>


</div>

<!-- ================= ADD ASSIGNMENT MODAL (SCAFFOLD) ================= -->
<div class="modal-overlay" id="addAssignmentModal" data-modal-class="visible">
    <div class="modal card">
        <h2>Add Assignment</h2>
        <form method="POST" action="{{ url_for('assignment.add_assignment') }}">
            <!-- Class selection -->
            <label for="assignment-class" class="input-label">Class</label>
            <select id="assignment-class" name="class_id" class="input-field" required>
                {% for c in classes %}
                <option value="{{ c.class_id }}">{{ c.class_name }}</option>
                {% endfor %}
            </select>

            <!-- Assignment title -->
            <label for="assignment-title" class="input-label">Assignment Name</label>
            <input
                type="text"
                id="assignment-title"
                name="assignment-title"
                class="input-field"
                placeholder="Assignment name"
                required
            >

            <!-- Assignment type -->
            <label for="assignment-type" class="input-label">Type</label>
            <select id="assignment-type" name="assignment-type" class="input-field" required>
                <option value="homework">Homework</option>
                <option value="project">Project</option>
                <option value="quiz">Quiz</option>
                <option value="essay">Essay</option>
                <option value="test">Test</option>
                <option value="exam">Exam</option>
                <option value="lab_report">Lab Report</option>
                <option value="other">Other</option>
            </select>

            <!-- Optional due date -->
            <label for="due-date" class="input-label">Due Date</label>
            <input type="date" name="due_date" id="due-date" class="input-field">

            <!-- Graded checkbox -->
            <label>
                <input type="checkbox" name="is_graded">
                Graded
            </label>

            <!-- Ponderation -->
            <label for="ponderation">Ponderation (optional)</label>
            <input type="number" id="ponderation" name="ponderation" min="1" max="100">

            <div class="modal-actions">
                <button type="submit" class="btn full-btn">Save</button>
                <button type="button" class="btn ghost-btn" data-close-modal>Cancel</button>
            </div>
        </form>
    </div>
</div>





{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/modal.js') }}"></script>
<script src="{{ url_for('static', filename='js/form.js') }}"></script>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="{{ url_for('static', filename='js/assignments.js') }}"></script>
<script src="{{ url_for('static', filename='js/constants.js') }}"></script>

{% endblock %}
