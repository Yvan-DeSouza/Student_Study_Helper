{% extends "base.html" %}
{% block title %}Home | StudyMate{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/form.css') }}">
{% endblock %}

{% block navbar %}
<nav class="navbar card">
    <div class="nav-left">
        <img src="{{ url_for('static', filename='images/study_logo.png') }}" class="nav-logo" alt="StudyMate logo">
        <span class="brand-name">StudyMate</span>
    </div>

    <div class="nav-center">
        <a href="{{ url_for('main.home') }}" class="nav-link active">Home</a>
        <a href="{{ url_for('classes.list_classes') }}" class="nav-link">Classes</a>
        <a href="{{ url_for('assignment.list_assignments') }}" class="nav-link">Assignments</a>
        <a href="{{ url_for('study.study_sessions') }}" class="nav-link">Study Sessions</a>
        <a href="{{ url_for('dashboard.graphs') }}" class="nav-link">Dashboard</a>
        <a href="{{ url_for('calendar.home') }}" class="nav-link">Calendar</a>
    </div>

    <div class="nav-right">
        <a href="{{ url_for('auth.logout') }}" class="logout-link">Logout</a>
        <div class="user-avatar">
            <img src="{{ url_for('static', filename='images/user_avatar.png') }}" alt="User avatar">
        </div>
        <button class="theme-toggle" id="home-theme-btn" aria-label="Toggle theme">
            <span class="toggle-icon">☀️</span>
        </button>
    </div>
</nav>
{% endblock %}

{% block content %}
<div class="home-container">

    <!-- ================= HERO ================= -->
    <header class="hero-section">
        <img src="{{ url_for('static', filename='images/computer.png') }}" class="floating-img left-img" alt="">
        <div class="hero-text">
            <h1>Welcome, <span>{{ user.username }}</span></h1>
            <p>
                Manage your study sessions, keep track of assignments,<br>
                and stay on top of your deadlines!
            </p>
        </div>
        <img src="{{ url_for('static', filename='images/stack_books.png') }}" class="floating-img right-img" alt="">
    </header>

    <!-- ================= GRID ================= -->
    <div class="dashboard-grid">

        <!-- ===== LEFT COLUMN ===== -->
        <div class="col-left">

            <!-- Log Study Session -->
            <div class="card widget">
                <h3>Log Study Session</h3>
                <form
                    method="POST"
                    action="{{ url_for('study.add_session') }}"
                    id="study-session-form"
                    data-has-active-session="{{ 'true' if has_active_session else 'false' }}"
                >
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                    <!-- Overlay message (hidden by default) -->
                    <div class="form-overlay hidden">
                        <p>
                            There is an ongoing study session.<br>
                            Only one session is allowed at a time.
                        </p>
                    </div>

                    <div class="form-body">
                        <!-- Start Now / Start Later -->
                        <div class="input-group">
                            <div class="radio-group-title">Start Time</div>

                            <div class="radio-row">
                                <label class="radio-option">
                                    <input type="radio" name="start_option" value="now" checked>
                                    <span>Start Now</span>
                                </label>

                                <label class="radio-option">
                                    <input type="radio" name="start_option" value="later">
                                    <span>Start Later</span>
                                </label>
                            </div>
                        </div>


                        <!-- Started At (only required if 'later') -->
                        <div class="input-group" id="started-at-group" style="display: none;">
                            <label for="started-at" class="input-label">Start Date & Time</label>
                            <input type="datetime-local" id="started-at" name="started_at" class="input-field">
                        </div>

                        <!-- Class, Title, Session Type -->
                        <label for="study-class" class="input-label">Class</label>
                        <select id="study-class" name="class_id" class="input-field" required>
                            {% for c in classes %}
                            <option value="{{ c.class_id }}">{{ c.class_name }}</option>
                            {% endfor %}
                        </select>

                        <label for="session-title" class="input-label">Session Title</label>
                        <input type="text" id="session-title" name="title" class="input-field" placeholder="e.g. Calculus practice" required>

                        <label for="session-type" class="input-label">Session Type</label>
                        <select id="session-type" name="session_type" class="input-field" required>
                            <option value="homework">Homework</option>
                            <option value="project">Project</option>
                            <option value="quiz">Quiz</option>
                            <option value="essay">Essay</option>
                            <option value="test">Test</option>
                            <option value="exam">Exam</option>
                            <option value="lab_report">Lab Report</option>
                            <option value="other">Other</option>
                        </select>

                        <!-- Assignment (optional) -->
                        <label for="study-assignment" class="input-label">Assignment (optional)</label>
                        <select id="study-assignment" name="assignment_id" class="input-field">
                            <option value="">None</option>
                            {% for a in assignments %}
                            <option value="{{ a.assignment_id }}" data-class="{{ a.class_id }}">{{ a.title }}</option>
                            {% endfor %}
                        </select>

                        <!-- Expected Duration (optional) -->
                        <div class="input-row">
                            <label for="expected-duration" class="input-label">Expected Duration (optional)</label>
                            <input type="number" id="expected-duration" name="expected_duration_minutes" class="input-field" min="0">
                            <span class="unit">min</span>
                        </div>

                        <button class="btn full-btn" type="submit" id="session-submit-btn">Start Session</button>
                    </div>
                </form>
                
            </div>

            <!-- Log Assignment -->
            <div class="card widget">
                <h3>Log New Assignment</h3>

                <form method="POST" action="{{ url_for('assignment.add_assignment') }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <!-- Mandatory: Class & Assignment Name -->
                    <label for="assignment-class" class="input-label">Class</label>
                    <select id="assignment-class" name="class_id" class="input-field" required>
                        {% for c in classes %}
                        <option value="{{ c.class_id }}">{{ c.class_name }}</option>
                        {% endfor %}
                    </select>

                    <label for="assignment-title" class="input-label">Assignment Name</label>
                    <input
                        id="assignment-title"
                        type="text"
                        name="assignment_title"
                        class="input-field"
                        required
                    >

                    <!-- Mandatory: Assignment Type -->
                    <label for="assignment-type" class="input-label">Assignment Type</label>
                    <select id="assignment-type" name="assignment_type" class="input-field">
                        <option value="homework">Homework</option>
                        <option value="project">Project</option>
                        <option value="quiz">Quiz</option>
                        <option value="essay">Essay</option>
                        <option value="test">Test</option>
                        <option value="exam">Exam</option>
                        <option value="lab_report">Lab Report</option>
                        <option value="other">Other</option>
                    </select>



                    <!-- Optional: Due Date -->
                    <label for="due_date" class="input-label">Due Date <span class="hint">(optional)</span></label>
                    <input
                        id="due_date"
                        type="date"
                        name="due_date"
                        class="input-field"
                    >

                    <!-- ===== GRADED CHECKBOX ===== -->
                    <div class="checkbox-row">
                        <input
                            type="checkbox"
                            id="is-graded"
                            name="is_graded"
                            class="checkbox-input"
                            data-toggle-checkbox="graded-options-container"
                        >
                        <label for="is-graded" class="checkbox-label">
                            <span class="checkbox-box"></span>
                            This assignment is graded
                        </label>
                    </div>



                    <!-- Advanced Options Toggle -->
                    <button type="button" class="advanced-toggle">▸ Advanced options</button>
                    <div class="advanced-options hidden"> 


                        <!-- Ponderation & Pass Grade (conditional) -->
                        <div id="graded-options-container" class="graded-options hidden">
                            <label for="ponderation" class="input-label">
                                Ponderation, from 1–5 (Optional)
                                <span class="hint-icon" data-hint="What is the relative weight of this assignment compared to others.">?</span>
                            </label>
                            <input
                                id="ponderation"
                                type="number"
                                name="ponderation"
                                class="input-field"
                                min="1"
                                max="5"
                            >

                            <label for="pass_grade" class="input-label">
                                Pass Grade in % (Optional)
                                <span class="hint-icon" data-hint="What is the minimum grade you would consider a passing grade?">?</span>
                            </label>
                            <input
                                id="pass_grade"
                                type="number"
                                name="pass_grade"
                                class="input-field"
                                min="0"
                                max="100"
                                step="0.1"
                            >
                        </div>
                        <label for="difficulty" class="input-label">Difficulty (Optional)
                            <span class="hint-icon" data-hint="How difficult do you expect this assignment to be.">?</span>
                        </label>
                        <input
                            type="number"
                            name="difficulty"
                            class="input-field"
                            min="1"
                            max="10"
                            placeholder="1 (easy) – 10 (hard)"
                        > 
                        <!-- Optional: Estimated Time -->
                        <div class="input-row">
                            <label for="estimated_minutes" class="input-label">Estimated Time (optional)
                                <span class="hint-icon" data-hint="How much time do you think this assignment will take you.">?</span>
                            </label>
                            <input
                                id="estimated_minutes"
                                type="number"
                                name="estimated_minutes"
                                class="input-field"
                                min="1"
                            >
                            <span class="unit">min</span>
                        </div>
                    </div> 

                    <button class="btn full-btn" type="submit">Log Assignment</button>
                </form>
            </div>
            

        </div>

        <!-- ===== MIDDLE COLUMN ===== -->
        <div class="col-mid">

            <div class="card widget">
                <h3>Upcoming Deadlines</h3>
                <div class="chart-placeholder">
                    <span>Upcoming deadlines will appear here</span>
                </div>
            </div>

            <div class="card widget">
                <h3>Recent Assignments</h3>
                <div class="chart-placeholder">
                    <span>Recently added assignments will appear here</span>
                </div>
            </div>

        </div>

        <!-- ===== RIGHT COLUMN ===== -->
        <div class="col-right">

            <div class="card widget chart-widget">
                <div class="chart-header">
                    <h3>Time per Class</h3>
                    <button class="btn-tiny" data-open-modal ="addClassModal" type="button">
                        Add Class
                    </button>
                </div>
                <div class="chart-placeholder">
                    <span>Charts coming soon</span>
                </div>
            </div>

            <div class="split-row">
                <div class="card widget small-stat">
                    <h3>Study Time</h3>
                    <div class="chart-placeholder small">
                        <span>—</span>
                    </div>
                </div>

                <div class="card widget small-stat">
                    <h3>Weekly Study Hours</h3>
                    <div class="chart-placeholder small">
                        <span>—</span>
                    </div>
                </div>
            </div>

            <div class="card widget performance-widget">
                <h3>Performance Snapshot</h3>
                <div class="chart-placeholder">
                    <span>Performance analytics coming soon</span>
                </div>
                <button class="btn pill-btn full-width-pill" type="button">
                    Go to Calendar
                </button>
            </div>

        </div>
    </div>
</div>


{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/form_lock.js') }}"></script>
<script src="{{ url_for('static', filename='js/home.js') }}"></script>
<script src="{{ url_for('static', filename='js/study_sessions.js') }}"></script>
<script src="{{ url_for('static', filename='js/form.js') }}"></script>
<script src="{{ url_for('static', filename='js/constants.js') }}"></script>
<script src="{{ url_for('static', filename='js/modal.js') }}"></script>
<script src="{{ url_for('static', filename='js/add_class.js') }}"></script>

{% endblock %}
